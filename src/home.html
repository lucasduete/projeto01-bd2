<!DOCTYPE html>
<html data-ng-app="projetoBD">
	<head>
		
		<title>Home</title>
		
		<meta charset="UTF-8">

		<link rel="stylesheet" type="text/css" href="asserts/css/index.css">
		<link rel="stylesheet" type="text/css" href="asserts/css/divMap.css">
		<link rel="stylesheet" type="text/css" href="asserts/css/inputSearchBox.css">
		<script type="text/javascript" src="asserts/js/getLocationFromBrowser.js"></script>
		<script type="text/javascript" src="asserts/js/createMarkerInfo.js"></script>
		<script type="text/javascript" src="asserts/js/setSearchBox.js"></script>

		<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
	</head>

	<body ng-controller="LocalController as Local" ng-init="Local.loadMarkers()">

		<input id="searchBox" class="controls" type="text" placeholder="Digite para Encontrar">
		<div id="map"></div>

		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.7/angular.min.js"></script>
    	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA26N7U2JuMCMfu1u4IJKGtSP7286dE45Q&libraries=places&callback=initMap" defer></script>
		<script type="text/javascript">
			angular.module('projetoBD', [])
				.controller('LocalController', LocalController);

				var map;

				function LocalController($http) {
					var vm = this;

					vm.loadMarkers = function loadMarkers() {
				  		$http({
					    	url: 'http://localhost:3000/api/localidades',
					    	method: 'GET'
				  		}).then(function (success) {
				  			let data = success.data;
				  			console.log('Data: ', data);
				    		
				    		let markers = data;
				    		for (marker of markers) {
				    			createMarkerInfo(marker, map);
				    		};
				    		
						   },function (error){
						   		console.log('Erro: ', error);
						   });
					}

				}
				LocalController.$inject = ['$http'];

			function initMap() {
        		map = new google.maps.Map(document.getElementById('map'), {
          			center: {lat: -6.887860, lng: -38.559366},
          			zoom: 16
        		});
	      		
        		getLocationFromBrowser(map);

		        let searchBox = document.getElementById('searchBox');
		        setSearchBox(searchBox, map);
	        };
		</script>
	</body>
</html>